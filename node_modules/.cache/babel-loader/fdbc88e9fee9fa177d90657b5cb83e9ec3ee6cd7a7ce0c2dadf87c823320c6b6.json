{"ast":null,"code":"// 3 lần sai -> khoá 60s. Lưu theo \"identifier\" (email/phone/username)\nconst KEY = 'login_lockout_v1';\nfunction load() {\n  try {\n    return JSON.parse(localStorage.getItem(KEY) || '{}');\n  } catch {\n    return {};\n  }\n}\nfunction save(m) {\n  localStorage.setItem(KEY, JSON.stringify(m));\n}\nexport function getLockState(identifier) {\n  const map = load();\n  const e = map[identifier];\n  if (!e) return {\n    locked: false,\n    remaining: 0,\n    count: 0\n  };\n  const now = Date.now();\n  if (e.lockUntil && now < e.lockUntil) {\n    return {\n      locked: true,\n      remaining: Math.ceil((e.lockUntil - now) / 1000),\n      count: e.count || 0\n    };\n  }\n  return {\n    locked: false,\n    remaining: 0,\n    count: e.count || 0\n  };\n}\nexport function registerFailure(identifier) {\n  const map = load();\n  const e = map[identifier] || {\n    count: 0\n  };\n  e.count += 1;\n  if (e.count >= 3) {\n    e.lockUntil = Date.now() + 60000; // 60s\n    e.count = 0;\n  }\n  map[identifier] = e;\n  save(map);\n}\nexport function resetFailures(identifier) {\n  const map = load();\n  delete map[identifier];\n  save(map);\n}","map":{"version":3,"names":["KEY","load","JSON","parse","localStorage","getItem","save","m","setItem","stringify","getLockState","identifier","map","e","locked","remaining","count","now","Date","lockUntil","Math","ceil","registerFailure","resetFailures"],"sources":["C:/Users/ACER/Desktop/Patiend_portal_fronend/Patient_portal_frontend/src/utils/lockout.js"],"sourcesContent":["// 3 lần sai -> khoá 60s. Lưu theo \"identifier\" (email/phone/username)\r\nconst KEY = 'login_lockout_v1';\r\n\r\nfunction load() {\r\n  try { return JSON.parse(localStorage.getItem(KEY) || '{}'); } catch { return {}; }\r\n}\r\nfunction save(m) { localStorage.setItem(KEY, JSON.stringify(m)); }\r\n\r\nexport function getLockState(identifier) {\r\n  const map = load();\r\n  const e = map[identifier];\r\n  if (!e) return { locked: false, remaining: 0, count: 0 };\r\n  const now = Date.now();\r\n  if (e.lockUntil && now < e.lockUntil) {\r\n    return { locked: true, remaining: Math.ceil((e.lockUntil - now) / 1000), count: e.count || 0 };\r\n  }\r\n  return { locked: false, remaining: 0, count: e.count || 0 };\r\n}\r\n\r\nexport function registerFailure(identifier) {\r\n  const map = load();\r\n  const e = map[identifier] || { count: 0 };\r\n  e.count += 1;\r\n  if (e.count >= 3) {\r\n    e.lockUntil = Date.now() + 60_000; // 60s\r\n    e.count = 0;\r\n  }\r\n  map[identifier] = e;\r\n  save(map);\r\n}\r\n\r\nexport function resetFailures(identifier) {\r\n  const map = load();\r\n  delete map[identifier];\r\n  save(map);\r\n}\r\n"],"mappings":"AAAA;AACA,MAAMA,GAAG,GAAG,kBAAkB;AAE9B,SAASC,IAAIA,CAAA,EAAG;EACd,IAAI;IAAE,OAAOC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAACL,GAAG,CAAC,IAAI,IAAI,CAAC;EAAE,CAAC,CAAC,MAAM;IAAE,OAAO,CAAC,CAAC;EAAE;AACnF;AACA,SAASM,IAAIA,CAACC,CAAC,EAAE;EAAEH,YAAY,CAACI,OAAO,CAACR,GAAG,EAAEE,IAAI,CAACO,SAAS,CAACF,CAAC,CAAC,CAAC;AAAE;AAEjE,OAAO,SAASG,YAAYA,CAACC,UAAU,EAAE;EACvC,MAAMC,GAAG,GAAGX,IAAI,CAAC,CAAC;EAClB,MAAMY,CAAC,GAAGD,GAAG,CAACD,UAAU,CAAC;EACzB,IAAI,CAACE,CAAC,EAAE,OAAO;IAAEC,MAAM,EAAE,KAAK;IAAEC,SAAS,EAAE,CAAC;IAAEC,KAAK,EAAE;EAAE,CAAC;EACxD,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;EACtB,IAAIJ,CAAC,CAACM,SAAS,IAAIF,GAAG,GAAGJ,CAAC,CAACM,SAAS,EAAE;IACpC,OAAO;MAAEL,MAAM,EAAE,IAAI;MAAEC,SAAS,EAAEK,IAAI,CAACC,IAAI,CAAC,CAACR,CAAC,CAACM,SAAS,GAAGF,GAAG,IAAI,IAAI,CAAC;MAAED,KAAK,EAAEH,CAAC,CAACG,KAAK,IAAI;IAAE,CAAC;EAChG;EACA,OAAO;IAAEF,MAAM,EAAE,KAAK;IAAEC,SAAS,EAAE,CAAC;IAAEC,KAAK,EAAEH,CAAC,CAACG,KAAK,IAAI;EAAE,CAAC;AAC7D;AAEA,OAAO,SAASM,eAAeA,CAACX,UAAU,EAAE;EAC1C,MAAMC,GAAG,GAAGX,IAAI,CAAC,CAAC;EAClB,MAAMY,CAAC,GAAGD,GAAG,CAACD,UAAU,CAAC,IAAI;IAAEK,KAAK,EAAE;EAAE,CAAC;EACzCH,CAAC,CAACG,KAAK,IAAI,CAAC;EACZ,IAAIH,CAAC,CAACG,KAAK,IAAI,CAAC,EAAE;IAChBH,CAAC,CAACM,SAAS,GAAGD,IAAI,CAACD,GAAG,CAAC,CAAC,GAAG,KAAM,CAAC,CAAC;IACnCJ,CAAC,CAACG,KAAK,GAAG,CAAC;EACb;EACAJ,GAAG,CAACD,UAAU,CAAC,GAAGE,CAAC;EACnBP,IAAI,CAACM,GAAG,CAAC;AACX;AAEA,OAAO,SAASW,aAAaA,CAACZ,UAAU,EAAE;EACxC,MAAMC,GAAG,GAAGX,IAAI,CAAC,CAAC;EAClB,OAAOW,GAAG,CAACD,UAAU,CAAC;EACtBL,IAAI,CAACM,GAAG,CAAC;AACX","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}